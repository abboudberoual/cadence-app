{% extends "base.html" %}
{% block content %}
<h2>Aura Farm — Media Creation</h2>

<div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:20px;">
    {% for act in activities %}
    <div style="border:1px solid #ddd; border-radius:8px; padding:10px; background:#fafafa;">
        <h4>{{ act.type }} — {{ act.name }}</h4>
        <p>{{ act.distance_km }} km • {{ act.moving_time_min }} min</p>

        {% if act.photos %}
          <img src="{{ act.photos['600'] }}" alt="Activity photo" style="width:100%; border-radius:6px;">
        {% elif act.map_polyline %}
          <div id="map{{ act.id }}" style="width:100%; height:200px;"></div>
          <script>
            var latlngs = L.Polyline.fromEncoded("{{ act.map_polyline }}").getLatLngs();
            var map = L.map("map{{ act.id }}", {zoomControl:false, attributionControl:false});
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            var route = L.polyline(latlngs, {color:'blue'}).addTo(map);
            map.fitBounds(route.getBounds());
          </script>
        {% else %}
          <p>No media available.</p>
        {% endif %}

        <a href="{{ url_for('share_preview', activity_id=act.id) }}">
          <button style="margin-top:10px;">Create Post</button>
        </a>
    </div>
    {% endfor %}
</div>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/@mapbox/polyline"></script>

{% endblock %}
